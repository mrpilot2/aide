ADD_EXECUTABLE(aide_ut
  main.cpp
)

TARGET_SOURCES(aide_ut
  PRIVATE
    applicationtest.cpp
)

TARGET_INCLUDE_DIRECTORIES(aide_ut
  PRIVATE
    catch
)

TARGET_COMPILE_DEFINITIONS(aide_ut
  PRIVATE
    $<$<CXX_COMPILER_ID:Clang>:CATCH_CONFIG_NO_CPP17_UNCAUGHT_EXCEPTIONS>
)

TARGET_LINK_LIBRARIES(aide_ut
  PRIVATE
    aide
)

ADD_TEST(NAME aide_ut COMMAND $<TARGET_FILE:aide_ut>
  WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
)

IF(ENABLE_COVERAGE)
  TARGET_COMPILE_OPTIONS(aide
    PRIVATE "-g" "-O0" "--coverage")
  SET_TARGET_PROPERTIES(aide PROPERTIES LINK_FLAGS "--coverage")
ENDIF()
